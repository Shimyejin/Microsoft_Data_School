{% extends "base.html" %}

{% block title %}Outlet Dive{% endblock %}

{% block content %}
<h2 style="margin-bottom: 1rem;">ğŸ”— Outlet Dive</h2>

<!-- ëŒ€ë¶„ë¥˜ íƒ­ -->
<div style="margin-bottom: 0.5rem;">
  {% for main in category_dict.keys() %}
    {% if main == current_main %}
      <strong style="margin-right: 1rem; border-bottom: 2px solid black;">{{ main }}</strong>
    {% else %}
      <a href="{{ url_for('outlet', main_category=main, category=category_dict[main][0]) }}"
         style="margin-right: 1rem; color: gray; text-decoration: none;">
        {{ main }}
      </a>
    {% endif %}
  {% endfor %}
</div>

<!-- ì†Œë¶„ë¥˜ íƒ­ -->
<div style="margin-bottom: 1.5rem; background-color: #f2f2f2; padding: 0.5rem;">
  {% for sub in category_dict[current_main] %}
    {% if sub == current_sub %}
      <strong style="margin-right: 1rem; border-bottom: 2px solid black;">{{ sub }}</strong>
    {% else %}
      <a href="{{ url_for('outlet', main_category=current_main, category=sub) }}"
         style="margin-right: 1rem; color: gray; text-decoration: none;">
        {{ sub }}
      </a>
    {% endif %}
  {% endfor %}
</div>

<!-- í•„í„° í¼ -->
<form method="get" style="margin-bottom: 2rem;">
  <input type="hidden" name="main_category" value="{{ current_main }}">
  <input type="hidden" name="category" value="{{ current_sub }}">
  <label>ë¸Œëœë“œ:</label>
  <input type="text" name="brand" placeholder="ì˜ˆ: ë¥´ì•„ë¥´" value="{{ request.args.get('brand', '') }}">
  <label>ìµœì†Œ í• ì¸ìœ¨:</label>
  <input type="number" name="discount_min" min="0" max="100" value="{{ request.args.get('discount_min', '') }}">
  <label>ìµœëŒ€ ê°€ê²©:</label>
  <input type="number" name="price_max" min="0" value="{{ request.args.get('price_max', '') }}">
  <button type="submit">í•„í„° ì ìš©</button>
</form>

<!-- ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ -->
{% if products %}
  <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
    {% for p in products %}
      <div style="border: 1px solid #ccc; border-radius: 10px; padding: 1rem; width: 300px; background-color: white;">
        <h3>{{ p.name }}</h3>
        <p><strong>ì •ê°€:</strong> {{ p.original_price }}ì›</p>
        <p><strong>í• ì¸ê°€:</strong> {{ p.discount_price }}ì› ({{ p.discount_rate }}%)</p>
        <p><strong>ë¦¬ë·° ìˆ˜:</strong> {{ p.review_count }}</p>
        <form method="post" action="{{ url_for('add_to_wishlist', product_id=p.product_id) }}">
          {% if p.product_id in wishlist_ids %}
            <button type="button" disabled>â­ ì°œ ì™„ë£Œ</button>
          {% else %}
            <button type="submit">â­ ì°œí•˜ê¸°</button>
          {% endif %}
        </form>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>ì¡°ê±´ì— ë§ëŠ” ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}

<!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
{% if total_pages > 1 %}
  <div style="margin-top: 2rem; text-align: center;">

    {# ë¸”ë¡ ê³„ì‚° #}
    {% set block_size = 5 %}
    {% set current_block = ((page - 1) // block_size) + 1 %}
    {% set block_start = (current_block - 1) * block_size + 1 %}
    {% set block_end = [block_start + block_size - 1, total_pages]|min %}

    {# << (ì²« ë¸”ë¡) #}
    {% if block_start > 1 %}
      <a href="{{ url_for('outlet', main_category=current_main, category=current_sub, page=1) }}">Â«</a>
    {% endif %}

    {# < (ì´ì „ í˜ì´ì§€) #}
    {% if page > 1 %}
      <a href="{{ url_for('outlet', main_category=current_main, category=current_sub, page=page-1) }}">â€¹</a>
    {% endif %}

    {# ìˆ«ìë“¤ #}
    {% for p in range(block_start, block_end + 1) %}
      {% if p == page %}
        <strong style="margin: 0 5px;">[{{ p }}]</strong>
      {% else %}
        <a href="{{ url_for('outlet', main_category=current_main, category=current_sub, page=p) }}" style="margin: 0 5px;">{{ p }}</a>
      {% endif %}
    {% endfor %}

    {# > (ë‹¤ìŒ í˜ì´ì§€) #}
    {% if page < total_pages %}
      <a href="{{ url_for('outlet', main_category=current_main, category=current_sub, page=page+1) }}">â€º</a>
    {% endif %}

    {# >> (ë§ˆì§€ë§‰ ë¸”ë¡) #}
    {% if block_end < total_pages %}
      <a href="{{ url_for('outlet', main_category=current_main, category=current_sub, page=total_pages) }}">Â»</a>
    {% endif %}

  </div>
{% endif %}
{% endblock %}