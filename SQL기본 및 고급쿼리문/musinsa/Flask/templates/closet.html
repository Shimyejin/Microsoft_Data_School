{% extends "base.html" %}

{% block title %}No.30 Closet{% endblock %}

{% block content %}
<h2 class="text-xl font-bold my-4">ğŸ™ ë‚˜ì˜ ìœ„ì‹œë¦¬ìŠ¤íŠ¸</h2>

<!-- ëŒ€ë¶„ë¥˜ í•„í„° -->
<form method="get" class="mb-6">
  <label for="main_category"><strong>ëŒ€ë¶„ë¥˜:</strong></label>
  <select name="main_category" id="main_category" onchange="this.form.submit()">
    <option value="ì „ì²´" {% if selected_main == 'ì „ì²´' %}selected{% endif %}>ì „ì²´</option>
    {% for main in main_categories %}
      <option value="{{ main }}" {% if selected_main == main %}selected{% endif %}>{{ main }}</option>
    {% endfor %}
  </select>
</form>

<!-- ì¹´ë“œ ëª©ë¡ -->
<div style="margin-top: 2rem; display: flex; flex-wrap: wrap; gap: 1rem;">
  {% for item in items %}
  <div style="border: 1px solid #ccc; padding: 1rem; border-radius: 10px; width: 300px; background-color: white;">
    <h3 class="font-bold mb-2">{{ item.name }}</h3>
    <p><strong>ì •ê°€:</strong> {{ item.original_price }}ì›</p>
    <p><strong>í• ì¸ê°€:</strong> {{ item.discount_price }}ì› ({{ item.discount_rate }}%)</p>
    <p><strong>ë¦¬ë·° ìˆ˜:</strong> {{ item.review_count }}</p>
    <p><strong>ë©”ëª¨:</strong> {{ item.memo or 'ì—†ìŒ' }}</p>

    <!-- ì‚­ì œ ë° ë©”ëª¨ ìˆ˜ì • ë²„íŠ¼ -->
    <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
      <form method="post" action="{{ url_for('delete_wishlist_item', wishlist_id=item.wishlist_id) }}">
        <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')" style="background: #f87171; color: white; border: none; padding: 6px 12px; border-radius: 5px;">ì‚­ì œ</button>
      </form>

      <button onclick="openMemoModal({{ item.wishlist_id }}, '{{ item.memo or '' }}')" style="background: #60a5fa; color: white; border: none; padding: 6px 12px; border-radius: 5px;">ë©”ëª¨</button>
    </div>
  </div>
  {% endfor %}
</div>

{% if not items %}
<p class="mt-4">ì•„ì§ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•œ ìƒí’ˆì´ ì—†ì–´ìš”!</p>
{% endif %}

<!-- ë©”ëª¨ ìˆ˜ì • ëª¨ë‹¬ -->
<div id="memoModal" style="display:none; position: fixed; top: 0; left: 0; width:100%; height:100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
  <div style="background:white; padding: 2rem; border-radius: 10px; width: 400px;">
    <h3 class="text-lg font-bold mb-2">ë©”ëª¨ ìˆ˜ì •</h3>
    <form method="post" action="{{ url_for('update_memo') }}">
      <input type="hidden" name="wishlist_id" id="memo_id">
      <textarea name="memo" id="memo_text" rows="4" style="width: 100%; margin-bottom: 1rem;"></textarea>
      <div style="text-align: right;">
        <button type="submit" style="background: #10b981; color: white; padding: 6px 12px; border: none; border-radius: 5px;">ì €ì¥</button>
        <button type="button" onclick="closeMemoModal()" style="margin-left: 0.5rem;">ì·¨ì†Œ</button>
      </div>
    </form>
  </div>
</div>

<!-- ë©”ëª¨ ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
function openMemoModal(id, memo) {
  document.getElementById('memo_id').value = id;
  document.getElementById('memo_text').value = memo.replace(/&quot;/g, '"').replace(/&#39;/g, "'");
  document.getElementById('memoModal').style.display = 'flex';
}
function closeMemoModal() {
  document.getElementById('memoModal').style.display = 'none';
}
</script>

{% endblock %}
